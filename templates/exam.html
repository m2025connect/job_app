<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>受験ページ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-slate-800 p-6">
  <div class="max-w-3xl mx-auto bg-white border border-slate-200 p-6 rounded shadow-sm">
    <h1 class="text-xl font-bold mb-4 text-[#1B0086]">受験ページ</h1>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="mb-4 space-y-2">
          {% for m in messages %}
            <div class="bg-green-50 text-green-900 border border-green-200 p-2 rounded">{{ m }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="POST" class="space-y-6">
      {% if not applicant %}
        <div class="bg-slate-50 border border-slate-200 p-3 rounded">
          <p class="mb-2 text-sm text-slate-600">最初に氏名とメールを入力してください（送信時に応募者として登録されます）。</p>
          <label class="block mb-1">氏名</label>
          <input type="text" name="name" class="w-full border rounded p-2 mb-3" required />
          <label class="block mb-1">メール</label>
          <input type="email" name="email" class="w-full border rounded p-2" required />
        </div>
      {% else %}
        <div class="bg-slate-50 border border-slate-200 p-3 rounded text-sm">
          応募者: {{ applicant.name }}（{{ applicant.email }}）
        </div>
      {% endif %}

      {% for q in questions %}
        {% set qtype = q.qtype if q.qtype is defined else q.type %}
        <div class="border border-slate-200 p-4 rounded">
          <div class="font-semibold mb-3">
            <span class="text-[#1B0086]">Q{{ loop.index }}.</span> {{ q.text }}
            <span class="ml-2 text-xs px-2 py-0.5 rounded bg-slate-100 text-slate-600 border border-slate-200">
              {{ '選択式' if qtype in ['mc','select'] else '自由記述' }}
            </span>
          </div>

          {% if qtype in ['free','text'] %}
            <textarea
              name="answer_free_{{ q.id }}"
              class="w-full border rounded p-3 h-32"
              placeholder="ここに自由記述で回答してください。"
              required
            ></textarea>
          {% else %}
            {% set opts = options_map.get(q.id) or [] %}
            <div class="space-y-2">
              {% for opt in opts %}
                <label class="flex items-start gap-2">
                  <input
                    type="radio"
                    name="answer_mc_{{ q.id }}"
                    value="{{ opt.id }}"
                    class="mt-1 accent-[#1B0086]"
                    required
                  >
                  <span>{{ opt.text }}</span>
                </label>
              {% else %}
                <div class="text-slate-500 text-sm">選択肢が設定されていません。</div>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% else %}
        <div class="text-slate-500">現在、問題は設定されていません。</div>
      {% endfor %}

      <button class="bg-[#1B0086] text-white px-4 py-2 rounded hover:brightness-110">送信</button>
    </form>
  </div>
</body>
</html>

